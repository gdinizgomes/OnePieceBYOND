<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- CORRE√á√ÉO CR√çTICA ---
        // Esta linha define a identidade do jogador para o Javascript.
        // Sem ela, o jogo n√£o sabe com quem falar e trava.
        const BYOND_REF = "{{BYOND_REF}}"; 
        
        // Ferramenta de Detec√ß√£o de Erros
        window.onerror = function(message, source, lineno, colno, error) {
            let errorBox = document.getElementById('error-debug');
            if (!errorBox) {
                errorBox = document.createElement('div');
                errorBox.id = 'error-debug';
                errorBox.style.cssText = 'position:fixed; top:0; left:0; width:100%; background:rgba(200,0,0,0.9); color:white; z-index:9999; padding:10px; font-family:monospace; pointer-events:none;';
                document.body.appendChild(errorBox);
            }
            errorBox.innerHTML += "ERRO JS: " + message + " em linha " + lineno + "<br>";
        };
    </script>
    <style>
        body { margin: 0; overflow: hidden; user-select: none; font-family: 'Segoe UI', sans-serif; }
        #ui-layer { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        
        /* HUD Principal */
        .char-info { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; color: white; border: 2px solid #d4af37; pointer-events: auto; }
        
        /* Barras */
        .bar-container { width: 200px; height: 10px; background: #333; margin-top: 5px; overflow: hidden; border: 1px solid #555; }
        .hp-bar { width: 100%; height: 100%; background: #e74c3c; transition: width 0.2s; }
        .xp-bar { width: 0%; height: 100%; background: #9b59b6; transition: width 0.2s; } 

        /* Janela de Status */
        #stat-window {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 300px; background: rgba(0, 0, 0, 0.85); color: white;
            border: 2px solid #d4af37; border-radius: 10px; padding: 20px;
            display: none; 
            pointer-events: auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        .stat-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 14px; }
        .stat-btn {
            background: #d4af37; color: black; border: none; border-radius: 4px;
            width: 25px; height: 25px; font-weight: bold; cursor: pointer;
        }
        .stat-btn:hover { background: #f1c40f; }
        .stat-btn:disabled { background: #555; cursor: default; }

        /* Logs e outros */
        #combat-log { position: absolute; bottom: 20px; right: 20px; width: 300px; height: 150px; background: rgba(0,0,0,0.5); color: #fff; font-size: 12px; overflow-y: auto; padding: 10px; border-radius: 5px; font-family: monospace; pointer-events: auto; }
        .log-hit { color: #e74c3c; font-weight: bold; } 
        .log-miss { color: #95a5a6; } 
        #notif-area { position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); text-align: center; }
        .name-label { position: absolute; color: white; background: rgba(0,0,0,0.5); padding: 2px 5px; border-radius: 4px; font-size: 10px; pointer-events: none; text-shadow: 1px 1px 0 #000; display: none; }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div class="char-info">
            <div id="name-display" style="font-size: 18px; font-weight: bold;">Loading...</div>
            <div style="font-size: 12px; color: #aaa;">Lvl <span id="lvl-display">0</span></div>
            
            <div style="font-size:10px; margin-top:5px;">HP</div>
            <div class="bar-container"><div id="hp-bar-fill" class="hp-bar"></div></div>
            
            <div style="font-size:10px; margin-top:2px;">EXP</div>
            <div class="bar-container" style="height: 6px;"><div id="xp-bar-fill" class="xp-bar"></div></div>
            
            <div style="margin-top:5px; color:#f1c40f">üí∞ <span id="gold-display">0</span> Berries</div>
            <div style="margin-top:5px; font-size: 10px; color: #ccc;">[C] Status</div>
        </div>

        <div id="stat-window">
            <div style="text-align: center; border-bottom: 1px solid #555; margin-bottom: 10px; padding-bottom: 5px;">
                <strong>PERSONAGEM</strong>
            </div>
            <div class="stat-row"><span>Pontos Dispon√≠veis:</span> <span id="stat-points" style="color: #f1c40f; font-weight:bold;">0</span></div>
            <hr style="border-color: #333">
            
            <div class="stat-row">
                <span>For√ßa (STR)</span>
                <div><span id="val-str">0</span> <button class="stat-btn" onclick="addStat('str')">+</button></div>
            </div>
            <div class="stat-row">
                <span>Vitalidade (VIT)</span>
                <div><span id="val-vit">0</span> <button class="stat-btn" onclick="addStat('vit')">+</button></div>
            </div>
            <div class="stat-row">
                <span>Agilidade (AGI)</span>
                <div><span id="val-agi">0</span> <button class="stat-btn" onclick="addStat('agi')">+</button></div>
            </div>
            <div class="stat-row">
                <span>Sabedoria (WIS)</span>
                <div><span id="val-wis">0</span> <button class="stat-btn" onclick="addStat('wis')">+</button></div>
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="toggleStats()" style="padding: 5px 15px; cursor: pointer;">Fechar</button>
            </div>
        </div>

        <div id="notif-area"></div>
        <div id="combat-log">System: RPG Core Active.<br></div>
        <div id="labels-container"></div>
    </div>

    <script src="definitions.js"></script>
    <script src="factory.js"></script>
    <script src="engine.js"></script> 
    <script src="game.js"></script>
</body>
</html>