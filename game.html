<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const BYOND_REF = "{{BYOND_REF}}"; 
        window.onerror = function(message, source, lineno, colno, error) {
            let errorBox = document.getElementById('error-debug');
            if (!errorBox) {
                errorBox = document.createElement('div');
                errorBox.id = 'error-debug';
                errorBox.style.cssText = 'position:fixed; top:0; left:0; width:100%; background:rgba(200,0,0,0.9); color:white; z-index:9999; padding:10px; font-family:monospace; pointer-events:none;';
                document.body.appendChild(errorBox);
            }
            errorBox.innerHTML += "ERRO JS: " + message + " em linha " + lineno + "<br>";
        };
    </script>
    <style>
        body { margin: 0; overflow: hidden; user-select: none; font-family: 'Segoe UI', sans-serif; }
        #ui-layer { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        
        /* ... Estilos anteriores mantidos ... */
        .char-info { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; color: white; border: 2px solid #d4af37; pointer-events: auto; min-width: 200px; }
        .bar-container { width: 100%; height: 10px; background: #333; margin-top: 2px; overflow: hidden; border: 1px solid #555; }
        .hp-bar { width: 100%; height: 100%; background: #e74c3c; transition: width 0.2s; }
        .en-bar { width: 100%; height: 100%; background: #3498db; transition: width 0.2s; }
        .xp-bar { width: 0%; height: 100%; background: #9b59b6; transition: width 0.2s; } 
        .prof-bar-bg { width: 100px; height: 4px; background: #333; display: inline-block; margin-left: 10px; vertical-align: middle; }
        .prof-bar-fill { width: 0%; height: 100%; background: #2ecc71; transition: width 0.5s; }

        #controls-help {
            position: absolute; bottom: 20px; left: 20px;
            background: rgba(0,0,0,0.5); color: #ccc;
            padding: 10px; border-radius: 5px; font-size: 11px;
            font-family: monospace;
        }

        #stat-window {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 340px; background: rgba(0, 0, 0, 0.9); color: white;
            border: 2px solid #d4af37; border-radius: 10px; padding: 20px;
            display: none; pointer-events: auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        .stat-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 14px; }
        .stat-sub { font-size: 12px; color: #aaa; width: 80px; }
        .stat-btn {
            background: #d4af37; color: black; border: none; border-radius: 4px;
            width: 20px; height: 20px; font-weight: bold; cursor: pointer; font-size: 12px;
        }
        
        /* --- NOVO INVENT√ÅRIO GRID --- */
        #inventory-window {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 320px; background: rgba(20, 20, 30, 0.95);
            border: 2px solid #3498db; border-radius: 10px; padding: 15px;
            display: none; pointer-events: auto; color: white;
            flex-direction: column;
        }
        #inv-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 Colunas */
            grid-template-rows: repeat(3, 1fr);    /* 3 Linhas */
            gap: 8px; margin-top: 10px;
        }
        .inv-slot {
            width: 60px; height: 60px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #555;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .inv-slot:hover { border-color: #f1c40f; }
        .inv-slot.equipped { border: 2px solid #e67e22; box-shadow: 0 0 10px #e67e22; }
        
        .inv-icon {
            width: 100%; height: 100%; border-radius: 4px;
        }
        .inv-qty {
            position: absolute; bottom: 2px; right: 4px;
            font-size: 12px; font-weight: bold; color: white;
            text-shadow: 1px 1px 0 #000;
        }
        .inv-actions {
            position: absolute; top: 100%; left: 0; width: 100%;
            background: #222; border: 1px solid #555; z-index: 10;
            display: none; flex-direction: column;
        }
        .inv-slot:hover .inv-actions { display: flex; }
        .action-btn {
            background: none; border: none; color: white; font-size: 10px;
            padding: 4px; cursor: pointer; text-align: center;
            border-bottom: 1px solid #444;
        }
        .action-btn:hover { background: #444; }

        /* Tooltip de Descri√ß√£o */
        #tooltip {
            position: absolute; background: rgba(0,0,0,0.9); border: 1px solid #aaa;
            color: #eee; padding: 8px; font-size: 12px; border-radius: 4px;
            pointer-events: none; display: none; z-index: 2000; max-width: 200px;
        }
        #tooltip strong { color: #f1c40f; display: block; margin-bottom: 3px; }

        #combat-log { position: absolute; bottom: 20px; right: 20px; width: 300px; height: 150px; background: rgba(0,0,0,0.5); color: #fff; font-size: 12px; overflow-y: auto; padding: 10px; border-radius: 5px; font-family: monospace; pointer-events: auto; }
        .log-hit { color: #e74c3c; font-weight: bold; } 
        #notif-area { position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); text-align: center; }
        
        #faint-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(50, 0, 0, 0.6);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; pointer-events: none;
        }
        #interaction-hint {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7); color: #f1c40f; padding: 10px 20px; border-radius: 20px;
            font-weight: bold; display: none; pointer-events: none; border: 1px solid #f1c40f;
        }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div id="faint-overlay">
            <div style="font-size: 30px; color: #ff5555; font-weight: bold;">VOC√ä EST√Å DESMAIADO</div>
            <div id="faint-timer" style="font-size: 60px; color: white;">15</div>
        </div>

        <div id="interaction-hint">[E] Pegar Item</div>
        <div id="tooltip"></div>

        <div class="char-info">
            <div id="name-display" style="font-size: 18px; font-weight: bold;">Loading...</div>
            <div style="font-size: 12px; color: #aaa;">Lvl <span id="lvl-display">0</span></div>
            <div style="font-size:10px;">HP <span id="hp-text"></span></div> <div class="bar-container"><div id="hp-bar-fill" class="hp-bar"></div></div>
            <div style="font-size:10px;">Energy <span id="en-text"></span></div> <div class="bar-container"><div id="en-bar-fill" class="en-bar"></div></div>
            <div style="font-size:10px;">EXP</div> <div class="bar-container" style="height: 4px;"><div id="xp-bar-fill" class="xp-bar"></div></div>
            <div style="margin-top:5px; color:#f1c40f">üí∞ <span id="gold-display">0</span> Berries</div>
            <div style="margin-top:5px; font-size: 10px; color: #ccc;">[C] Status | [I] Mochila</div>
        </div>

        <div id="controls-help">
            <strong>CONTROLES:</strong><br>
            [W,A,S,D] Mover<br>[SHIFT] Correr<br>[Espa√ßo] Pular<br>
            [A] Soco &nbsp; [S] Chute<br>[D] Espada [F] Arma<br>
            [R] Descansar<br>[C] Stats [I] Itens [E] Pegar
        </div>

        <div id="stat-window">
            <div style="text-align: center; border-bottom: 1px solid #555; margin-bottom: 10px;"><strong>ATRIBUTOS</strong></div>
            <div class="stat-row"><span>Pontos:</span> <span id="stat-points" style="color: #f1c40f;">0</span></div>
            <div class="stat-row"><span>For√ßa</span> <div><span id="val-str">0</span> <button class="stat-btn" onclick="addStat('str')">+</button></div></div>
            <div class="stat-row"><span>Vitalidade</span> <div><span id="val-vit">0</span> <button class="stat-btn" onclick="addStat('vit')">+</button></div></div>
            <div class="stat-row"><span>Agilidade</span> <div><span id="val-agi">0</span> <button class="stat-btn" onclick="addStat('agi')">+</button></div></div>
            <div class="stat-row"><span>Sabedoria</span> <div><span id="val-wis">0</span> <button class="stat-btn" onclick="addStat('wis')">+</button></div></div>
            <hr style="border-color: #333;">
            <div class="stat-row"><span>Soco Lv.<span id="prof-punch">1</span></span><div class="prof-bar-bg"><div id="bar-punch" class="prof-bar-fill"></div></div></div>
            <div class="stat-row"><span>Chute Lv.<span id="prof-kick">1</span></span><div class="prof-bar-bg"><div id="bar-kick" class="prof-bar-fill"></div></div></div>
            <div class="stat-row"><span>Espada Lv.<span id="prof-sword">1</span></span><div class="prof-bar-bg"><div id="bar-sword" class="prof-bar-fill"></div></div></div>
            <div class="stat-row"><span>Arma Lv.<span id="prof-gun">1</span></span><div class="prof-bar-bg"><div id="bar-gun" class="prof-bar-fill"></div></div></div>
            <div style="text-align: center; margin-top: 15px;"><button onclick="toggleStats()">Fechar</button></div>
        </div>

        <div id="inventory-window">
            <div style="text-align: center; border-bottom: 1px solid #3498db; padding-bottom: 5px; font-weight: bold;">
                MOCHILA (12 Slots)
            </div>
            <div id="inv-grid">
                </div>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="toggleInventory()" style="padding: 5px 15px; cursor: pointer;">Fechar</button>
            </div>
        </div>

        <div id="notif-area"></div>
        <div id="combat-log">System: RPG Core Active.<br></div>
        <div id="labels-container"></div>
    </div>

    <script src="definitions.js"></script>
    <script src="factory.js"></script>
    <script src="engine.js"></script> 
    <script src="game.js"></script>
</body>
</html>